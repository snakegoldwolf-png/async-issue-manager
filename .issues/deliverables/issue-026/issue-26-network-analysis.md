# Issue #26 - 网络慢/下载卡顿问题排查报告

**排查时间**: 2026-02-27 09:35  
**负责人**: Debugger  
**优先级**: P3

---

## 1. 问题描述

经常遇到网络下载很慢的问题，需要排查：
- 是电脑问题？
- 是代理问题？
- 是 DNS 问题？
- 还是其他原因？

---

## 2. 排查过程

### 2.1 网络基础检查

**本地网络**：
```
网络类型: Wi-Fi
IP 地址: 192.168.0.100
子网掩码: 255.255.255.0
路由器: 192.168.0.1
```

**路由器连通性**：
```
ping 192.168.0.1
延迟: 2.7ms - 8.5ms（正常）
丢包率: 0%
```

✅ **本地网络正常**

### 2.2 DNS 配置检查

**当前 DNS 配置**：
```
nameserver[0]: 1.1.1.1 (Cloudflare)
nameserver[1]: 8.8.8.8 (Google)
状态: Reachable
```

✅ **DNS 配置正常**（使用国际知名 DNS）

### 2.3 直连网络测试

**Ping 国际服务器**：
```
ping 8.8.8.8 (Google DNS)
延迟: 322ms - 336ms（非常高！）
丢包率: 0%
```

**直连访问百度**：
```
curl https://www.baidu.com (无代理)
耗时: 1.34s
速度: 1,816 bytes/s（非常慢）
```

**直连下载测试**：
```
curl http://speedtest.tele2.net/1MB.zip (无代理)
状态: 超时（60秒内未完成）
```

❌ **直连网络非常慢**

### 2.4 代理配置检查

**系统代理设置**：
```
HTTP 代理: 127.0.0.1:7897 (已启用)
HTTPS 代理: 127.0.0.1:7897 (已启用)
SOCKS 代理: 127.0.0.1:7897 (已启用)
```

**代理软件**：
```
软件: Vortex (com.vortex.helper)
PID: 3104
运行时间: 自 2月26日
状态: 正常运行
```

### 2.5 代理网络测试

**通过代理访问 Google**：
```
curl -x http://127.0.0.1:7897 https://www.google.com
耗时: 0.198s
速度: 93,799 bytes/s（正常）
```

**通过代理访问百度**：
```
curl -x http://127.0.0.1:7897 https://www.baidu.com
耗时: 0.072s
速度: 34,027 bytes/s（正常）
```

**通过代理下载测试**：
```
curl -x http://127.0.0.1:7897 http://speedtest.tele2.net/1MB.zip
速度: 421,572 bytes/s ≈ 411 KB/s（正常）
```

✅ **代理网络正常**

---

## 3. 对比分析

| 测试项 | 直连 | 代理 | 差异 |
|--------|------|------|------|
| Ping 8.8.8.8 | 330ms | - | 延迟高 |
| 访问百度 | 1.34s | 0.07s | **19倍** |
| 访问 Google | 超时 | 0.2s | **代理必需** |
| 下载 1MB | 超时 | 411KB/s | **代理必需** |

---

## 4. 根本原因

**结论**：网络慢的根本原因是 **直连国际网络受限**。

**具体表现**：
1. 直连 ping 国际服务器延迟 330ms+（正常应 <100ms）
2. 直连下载国际资源超时
3. 直连访问国内网站也较慢（可能 DNS 解析走国际）

**不是以下问题**：
- ❌ 不是电脑问题（本地网络正常）
- ❌ 不是代理问题（代理工作正常）
- ❌ 不是 DNS 配置问题（DNS 配置合理）

**是以下问题**：
- ✅ 直连国际网络受限（ISP 或网络环境限制）
- ✅ 需要通过代理才能正常访问

---

## 5. 解决方案

### 5.1 确保代理始终运行

**当前状态**：Vortex 代理已配置并运行正常。

**建议**：
- 确保 Vortex 开机自启
- 定期检查代理状态

### 5.2 检查代理是否生效

如果遇到网络慢，先检查代理是否生效：

```bash
# 检查代理端口是否监听
lsof -i :7897

# 测试代理是否工作
curl -x http://127.0.0.1:7897 https://www.google.com
```

### 5.3 命令行工具配置

某些命令行工具可能不走系统代理，需要手动配置：

```bash
# 临时设置代理
export http_proxy=http://127.0.0.1:7897
export https_proxy=http://127.0.0.1:7897
export all_proxy=socks5://127.0.0.1:7897

# 或者在 ~/.zshrc 中永久配置
```

### 5.4 Git 代理配置

```bash
# 设置 Git 代理
git config --global http.proxy http://127.0.0.1:7897
git config --global https.proxy http://127.0.0.1:7897
```

### 5.5 npm/pip 代理配置

```bash
# npm
npm config set proxy http://127.0.0.1:7897
npm config set https-proxy http://127.0.0.1:7897

# pip
pip config set global.proxy http://127.0.0.1:7897
```

---

## 6. 总结

| 项目 | 状态 |
|------|------|
| 问题原因 | 直连国际网络受限 |
| 解决方案 | 使用代理（已配置） |
| 当前状态 | ✅ 代理正常工作 |
| 建议 | 确保代理始终运行，命令行工具配置代理环境变量 |

**核心结论**：
> 网络慢不是电脑或代理的问题，而是直连国际网络受限。
> 只要代理（Vortex）正常运行，网络速度就是正常的。

---

*报告生成时间: 2026-02-27 09:40*
